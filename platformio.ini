; PlatformIO 配置文件
; 糖尿病初筛监测系统 - ESP32-S3 最终版本

[platformio]
default_envs = esp32s3_final
src_dir = .

[env:esp32s3_final]
; === 开发板配置 ===
platform = espressif32 @ ^6.0.0
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

; === 串口配置 ===
upload_port = COM3              ; 根据实际COM口修改
monitor_port = ${upload_port}
upload_speed = 921600

; ==================== 编译优化 ====================
build_flags =
    ; 系统配置
    -DDEVICE_ROLE_WRIST
    -DMCU_ESP32_S3
    -DUSE_AMOLED_DISPLAY
    -DUSE_MAX30102
    -DUSE_BLE_NIMBLE
    
    ; 性能优化
    -O2                                    ; 优化级别O2
    -DBOARD_HAS_PSRAM                     ; 使用PSRAM
    -mfix-esp32-psram-cache-issue
    
    ; 芯片配置
    -DCFG_TUSB_DEBUG=0
    -DCORE_DEBUG_LEVEL=0                  ; 0=无输出, 1=ERROR, 2=WARN, 3=INFO, 4=DEBUG
    -DCONFIG_BT_NIMBLE_ENABLED=1          ; 启用NimBLE
    
    ; 功能开关
    -DDEBUG_MODE=1                        ; 打开调试模式
    -DVERBOSE_COLLECTOR_DEBUG=0
    
    ; 内存配置
    -DPSRAM_CACHE_WORKAROUND=1
    -DCONFIG_ESP32S3_SPIRAM_WORKAROUND_STRATEGY=MEMCPY

; ==================== 库依赖 ====================
lib_deps =
    ; ESP32核心库（自动包含）
    
    ; 显示驱动
    adafruit/Adafruit GFX Library @ ^1.11.5
    adafruit/Adafruit SSD1306 @ ^2.5.7
    bodmer/TFT_eSPI @ ^2.5.0              ; AMOLED支持
    
    ; 心率传感器
    sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.7
    
    ; BLE
    h2zero/NimBLE-Arduino @ ^1.4.0        ; NimBLE库
    
    ; 数据处理
    bblanchon/ArduinoJson @ ^6.21.0       ; JSON序列化
    
    ; I2C工具
    paulstoffregen/OneWire @ ^2.3.7

; ==================== 监控日志级别 ====================
monitor_filters = 
    esp32_exception_decoder
    time
    log2file

; ==================== 分区方案 ====================
board_build.partitions = huge_app.csv

; ESP32-S3 PSRAM 配置
board_build.memory_type = qio_opi
board_build.external_ram_type = opi
board_build.psram_type = opi

; ==================== 高级选项 ====================
[env:esp32s3_final_release]
; 发布版本配置
extends = esp32s3_final
build_flags =
    ${env:esp32s3_final.build_flags}
    -DDEBUG_MODE=0                       ; 禁用调试
    -DVERBOSE_COLLECTOR_DEBUG=0
    -O3                                   ; 最高优化
    -DNDEBUG                              ; 禁用断言