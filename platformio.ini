; PlatformIO 项目配置文件
; 糖尿病初筛监测系统 - 多环境配置

[platformio]
default_envs = wrist

; 通用配置
[env]
platform = espressif32
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; 编译选项
build_flags = 
    -Wall
    -Wextra
    -I./system
    -I./drivers
    -I./algorithm
    -I./config
    -I./utils
    -Wl,--print-memory-usage
    ; 调试信息（生产版本可关闭）
    ; -DDEBUG_MODE=1

; 源文件过滤
build_src_filter = 
    +<*> 
    +<./system/*.cpp>
    +<./drivers/*.cpp>
    +<./algorithm/*.cpp>
    +<./utils/*.cpp>
    -<src/main_minimal.cpp>        ; 排除极简测试文件
    -<.git/> 
    -<.svn/> 
    -<example/> 
    -<examples/> 
    -<test/> 
    -<tests/>

; ==================== 腕带主控环境 ====================
[env:wrist]
board = esp32-c3-devkitm-1
build_flags = 
    ${env.build_flags}
    -DDEVICE_ROLE_WRIST
    -DMCU_ESP32_C3
    -DUSE_MAX30102
    -DUSE_OLED_DISPLAY
    -DUSE_BLE_MODULE
    -DUSE_MOTION_CORRECTION

; 库依赖
lib_deps = 
    ; OLED 显示
    adafruit/Adafruit SSD1306@^2.5.7
    adafruit/Adafruit GFX Library@^1.11.9
    ; MAX30102 传感器
    sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library@^1.1.2
    ; BLE 支持（ESP32内置）
    ; 其他工具库
    madhephaestus/ESP32AnalogRead@^1.1.2

; 上传设置
upload_port = COM3  ; 根据实际串口修改
upload_protocol = esp-builtin

; ==================== 检测模块环境 ====================
[env:detector]
board = esp32-c3-devkitm-1
build_flags = 
    ${env.build_flags}
    -DDEVICE_ROLE_DETECTOR
    -DMCU_ESP32_C3
    -DUSE_SNO2_SENSOR
    -DUSE_HKG07_SENSOR
    -DUSE_AD623_AMP
    -DUSE_HEATING_CONTROL

; 库依赖
lib_deps = 
    ; 模拟读取
    madhephaestus/ESP32AnalogRead@^1.1.2
    ; 温度传感器（可选）
    adafruit/Adafruit DHT sensor library@^1.4.6

; 上传设置
upload_port = COM4  ; 根据实际串口修改
upload_protocol = esp-builtin

; ==================== 调试环境（Arduino Uno）====================
[env:uno_debug]
platform = atmelavr
board = uno
framework = arduino
build_flags = 
    -Wall
    -Wextra
    -I./system
    -I./drivers
    -I./algorithm
    -I./config
    -I./utils
    -DDEBUG_MODE=1
    -DDEVICE_ROLE_WRIST  ; 或 DETECTOR
    -DMCU_ARDUINO_UNO
    -DHR_USE_MOCK=1      ; 使用模拟传感器

lib_deps = 
    ; 模拟传感器库
    ; 串口调试工具

upload_speed = 115200
monitor_speed = 115200